## Bus Driver Interface

### 구현사항 v1.0
서버에 업데이트 된 데이터를 바탕으로 버스 드라이버 인터페이스에 갱신된 데이터를 바탕으로 UI를 출력하는 시스템 구현을 목표로 한다. 구현되어야 하는 시스템은 크게 이미지 출력, 신호 출력, 데이터 가져오기가 있다. 데이터는 웹 서버에서 가져와야 하는데 아직 웹 서버가 구축 중이기 때문에 데이터 송/수신을 웹 서버와의 통신이 아니라 소켓 통신을 이용하여 기본적인 기능을 갖춘 서버와 클라이언트 사이에서 통신을 진행하고 이를 기반으로 이미지와 신호(메시지) 등을 출력하거나 팝업 하는 기능을 구현하였다.

- 쓰레드를 이용한 서버 - 클라이언트 소켓 통신
- 클라이언트에서 서버로 메시지 송신 시스템 및 UI
- 클라이언트에서 메시지로 이미지 요청 시 서버에서 해당 이미지 전송 및 클라이언트 창에서 팝업

![1](https://user-images.githubusercontent.com/72551588/119267850-49a38180-bc2b-11eb-9223-7e9439537f84.jpg)
server와 client 디렉토리에 있는 windows를 실행하면 사진과 같은 UI가 출력된다. 사진에서 보이는 것 처럼 왼쪽은 서버, 오른쪽은 클라이언트이다. 서버 UI에서 먼저 할당할 수 있는 IP와 PORT 번호를 입력하고 실행하면 정상적인 IP와 PORT 번호가 입력되었을 때 서버가 실행되면서 **[서버실행]** 버튼이 **[서버종료]** 버튼으로 바뀌게 된다.
실행한 서버에 입력된 IP와 PORT 번호를 클라이언트에 입력하여 **[서버접속]** 버튼을 누르면 사진과 같이 **[접속종료]** 버튼으로 바뀌게 되고 서버에는 접속한 클라이언트의 IP와 PORT 번호가 들어오게 된다. 이를 사용자가 원하는 대로 출력해서 사진과 같이 출력할 수 있게 했다.

![2](https://user-images.githubusercontent.com/72551588/119267852-4d370880-bc2b-11eb-95aa-cc39ff5a70b3.jpg)
연결된 상태에서는 클라이언트에서 메시지를 서버에 송신할 수 있다. 서버에 수신된 메시지가 일반적인 메시지라면 다시 클라이언트에 그 메시지를 보내주고 클라이언트는 정상적으로 수신이 되었다면 해당 메시지를 **받은 메시지**창에 띄워준다. 만약에 이미지 파일을 요청한다면 _(ex: 'abc.jpg')_ 해당 이미지가 서버에 존재한다면 그 이미지를 전송해준다. 클라이언트는 이미지가 정상적으로 전송이 된다면 이를 사진과 같이 팝업창으로 출력해준다.

### 구현사항 v2.2
- 새로 구현하는 시스템에 적합한 버스 기사 UI 구축
- 소켓 통신으로 데이터 전송이 아닌 웹 서버에서 데이터를 가져오는 클라이언트 구축
- 서버에 갱신된 신호 기반으로 출력해야 하는 신호 또는 이미지를 버스 기사 인터페이스에 출력
- 승차벨 신호, 정류장 상황 이미지, 예외 상황에 따라 출력되는 이미지가 변하도록 수정
- 버스 공공 데이터(API)를 활용한 앞/뒤차 위치 출력
- 신호가 발생한 정류장이 현재 버스의 위치의 다음 정류장 일 때 출력되도록 수정

**1. 버스 단말기 구현**
- 실제 버스 기사들이 쓰는 단말기를 구할 수 없으므로, 그와 유사한 GUI를 구현
- 인터페이스에 출력되는 주요 요소는 현재 시간, 다음 도착할 정류장 이름, 앞선 버스의 위치, 뒷선 버스의 위치, 주요 시그널 이미지 출력 공간
- 버스가 다음으로 도착할 정류장 이름을 얻어오고, 다른 버스들의 위치 정보를 얻어오기 위해서 '버스 위치 정보 API'를 사용


**2. 승차벨 신호 발생 시 출력**
![프레젠테이션1](https://user-images.githubusercontent.com/72551588/122676987-47791680-d21b-11eb-84ee-fa0860b2221f.jpg)
- 버스 정류장에서 승차 버튼을 누르면 웹서버 DB에 Stop Sig라는 항목이 해당 정류소의 고유 ID 번호로 올라간다. 이 때, 정류소의 고유 ID로 올리는 이유는 어느 정류장에서 승차벨이 눌렸는지를 API를 통해 판단하기 위해서이다. 운행중인 버스는 주기적으로 웹서버 DB에 접근해 해당 버스에 관한 내용중 Stop Sig가 올라가있으면 버스 기사 인터페이스에 Stop이라는 이미지가 팝업되어서 다음 도착할 정류장에 승차할 승객이 존재한다는 것을 알려준다.


**3. Fall Detection(낙상) 발생 시 이미지 출력**
![프레젠테이션2](https://user-images.githubusercontent.com/72551588/122676989-4c3dca80-d21b-11eb-8339-7d8773b8a7e5.jpg)
- 버스 정류장에서 일정시간 이상 쓰러짐이 감지된다면 웹서버에 해당 정류장의 상황 이미지가 저장되고, DB에 Fall Sig가 해당 정류장에 가장 빨리 도착하는 버스의 고유 ID번호로 올라간다. 이 때, 가장 빨리 도착하는 버스의 고유 ID번호로 올리는 이유는 웹서버에 올라간 여러 장의 이미지 중에서 버스가 다운로드 해야하는 사진을 구분하기 위해서이다. 운행중인 버스는 주기적으로 웹서버 DB에 접근해 해당 버스에 관한 내용중 Fall Sig가 올라가있으면 버스 기사 인터페이스에 해당 Fall-Detection 이미지가 팝업되어 낙상 사고가 발생했다는 것을 버스 기사에게 알려준다.
